# å¼€å‘ä¸è°ƒè¯•æŒ‡å—

æœ¬æ–‡æ¡£è¡¥å……è¯´æ˜å¦‚ä½•åœ¨æœ¬åœ°è¿è¡Œ Code Adventurers çš„å„ç±»æœåŠ¡ã€è°ƒè¯• API / æµ‹è¯•ï¼Œä»¥åŠå¸¸è§é—®é¢˜æ’æŸ¥æŠ€å·§ã€‚é˜…è¯»æœ¬æŒ‡å—å‰ï¼Œè¯·å…ˆå®Œæˆã€Šç¯å¢ƒé…ç½®.mdã€‹ä¸­åˆ—å‡ºçš„ä¾èµ–å®‰è£…ä¸æ•°æ®åº“åˆå§‹åŒ–ã€‚

## 1. å¸¸ç”¨ npm è„šæœ¬

| å‘½ä»¤ | ä½œç”¨ | å¤‡æ³¨ |
| --- | --- | --- |
| `npm run dev` | å¯åŠ¨ API æœåŠ¡ï¼ˆé»˜è®¤ç«¯å£ `3000`ï¼‰å¹¶è‡ªåŠ¨è½½å…¥å†…ç½®ç§å­æ•°æ®ï¼Œä¾¿äºæœ¬åœ°è”è°ƒã€‚ | æ”¯æŒ `PORT=4000 npm run dev` æŒ‡å®šç«¯å£ï¼›Windowsã€macOSã€Linux é€šç”¨ã€‚ |
| `npm run dev:api` | `dev` çš„åˆ«åï¼Œæ–¹ä¾¿åœ¨ CI / è„šæœ¬ä¸­å¼•ç”¨ã€‚ |  |
| `npm test` | æ‰§è¡Œå®Œæ•´çš„ Jest æµ‹è¯•å¥—ä»¶ã€‚ | å†…ç½® `cross-env`ï¼Œåœ¨ Windows ä¸Šæ— éœ€é¢å¤–è®¾ç½® `NODE_OPTIONS`ã€‚ |
| `npm run test:jest -- --watch` | ä»¥ watch æ¨¡å¼è¿è¡Œæµ‹è¯•ï¼Œä¾¿äº TDDã€‚ | æ”¯æŒè¿½åŠ  `--runTestsByPath tests/services/api.test.ts` åªè·‘æŒ‡å®šæ–‡ä»¶ã€‚ |
| `npm run build` | ä½¿ç”¨ `tsc` è¿›è¡Œç±»å‹æ£€æŸ¥ä¸ç¼–è¯‘ã€‚ | ç”Ÿæˆçš„æ„å»ºäº§ç‰©ä½äº `dist/`ï¼Œç›®å‰ä¸»è¦ç”¨äºéªŒè¯ç±»å‹å®‰å…¨ã€‚ |

> ğŸ’¡ **Windows ç”¨æˆ·æç¤º**ï¼šä¹‹å‰çš„ `NODE_OPTIONS=... jest` å†™æ³•åœ¨ PowerShell / CMD ä¸­ä¼šæŠ¥ â€œä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤â€ã€‚ç°åœ¨å·²ç»æ”¹ä¸ºè·¨å¹³å°çš„ `cross-env`ï¼Œç›´æ¥æ‰§è¡Œ `npm test` å³å¯ã€‚

## 2. è°ƒè¯• API æœåŠ¡

1. ç¡®è®¤ `.env` æˆ–ç¯å¢ƒå˜é‡é‡Œæä¾›äº† MySQL è¿æ¥ä¿¡æ¯ï¼ˆè‹¥çœç•¥åˆ™è‡ªåŠ¨ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼‰ã€‚
2. è¿è¡Œ `npm run dev`ï¼Œç»ˆç«¯ä¼šè¾“å‡ºç›‘å¬åœ°å€ï¼Œä¾‹å¦‚ï¼š
   ```text
   [dev] API server listening on http://localhost:3000
   ```
3. ä½¿ç”¨ Postman / curl / å‰ç«¯åº”ç”¨è°ƒç”¨ REST æ¥å£ï¼Œæˆ–é€šè¿‡ `tests/services/api.test.ts` å­¦ä¹ ç¤ºä¾‹è¯·æ±‚ã€‚
4. è‹¥éœ€è¦æ–­ç‚¹è°ƒè¯•ï¼Œå¯è¿½åŠ  Node Inspector å‚æ•°ï¼š
   ```bash
   npm run dev -- --inspect-brk
   ```
   ç„¶ååœ¨ VS Code ä¸­é€šè¿‡ â€œé™„åŠ åˆ° Node è¿›ç¨‹â€ å¯åŠ¨è°ƒè¯•ï¼Œæˆ–åœ¨ Chrome è¾“å…¥ `chrome://inspect` è¿æ¥ã€‚

## 3. è°ƒè¯• Jest æµ‹è¯•

- **å•æµ‹å®šä½**ï¼š`npm test -- --runTestsByPath tests/packages/engine.test.ts`ã€‚
- **èšç„¦å•ä¸ªç”¨ä¾‹**ï¼šåœ¨æµ‹è¯•æ–‡ä»¶é‡Œä½¿ç”¨ `test.only(...)` æˆ– `describe.only(...)`ã€‚
- **è°ƒè¯•æ–­ç‚¹**ï¼š
  ```bash
  node --inspect-brk ./node_modules/.bin/jest --runInBand --runTestsByPath tests/services/api.test.ts
  ```
  ä¹Ÿå¯ä»¥åœ¨ VS Code `launch.json` ä¸­é…ç½® `type: "node"`, `program: "${workspaceFolder}/node_modules/jest/bin/jest.js"`ã€‚

## 4. MySQL ç›¸å…³è¾…åŠ©è„šæœ¬

- `docs/database_schema.sql`ï¼šå®Œæ•´çš„å»ºè¡¨è¯­å¥ï¼Œè¦†ç›–ç”¨æˆ·ã€è¯¾ç¨‹ã€å…³å¡ã€UGCã€é¥æµ‹ç­‰å®ä½“ã€‚
- `docs/mysql_init.sql`ï¼šåŸºç¡€æ¼”ç¤ºæ•°æ®ï¼Œå¯åœ¨å¼€å‘æ¨¡å¼ä¸‹å¿«é€Ÿä½“éªŒå­¦ç”Ÿ / æ•™å¸ˆ / å®¶é•¿ / ç®¡ç†ç«¯æµç¨‹ã€‚
- å¦‚éœ€é‡ç½®å¼€å‘ç¯å¢ƒï¼š
  ```bash
  mysql -u root -p code_adventurers < docs/mysql_init.sql
  ```
  æˆ–è°ƒç”¨ API çš„ `/api/system/reset` ç«¯ç‚¹å¿«é€Ÿåˆ·æ–°å†…å­˜æ•°æ®ã€‚

## 5. å¸¸è§é—®é¢˜æ’æŸ¥

| ç°è±¡ | å¯èƒ½åŸå›  | è§£å†³æ–¹å¼ |
| --- | --- | --- |
| `Error: connect ECONNREFUSED 127.0.0.1:3306` | MySQL æœªå¯åŠ¨æˆ–ç«¯å£è¢«å ç”¨ | æ£€æŸ¥ `mysqld` çŠ¶æ€ï¼Œæˆ–åœ¨ `.env` è°ƒæ•´ `MYSQL_HOST` / `MYSQL_PORT`ã€‚ |
| `Error [ERR_MODULE_NOT_FOUND]: Cannot find module '@engine/index'` | æœªæ‰§è¡Œ `npm install` æˆ– TypeScript è·¯å¾„æœªè¢«è§£æ | é‡æ–°è¿è¡Œ `npm install`ï¼Œç¡®è®¤ `tsconfig.json` ä¸­ `baseUrl` / `paths` ç”Ÿæ•ˆã€‚ |
| æ¥å£è¿”å› 401 | è¯·æ±‚å¤´ç¼ºå°‘ `x-user-id` | åœ¨è°ƒè¯•å·¥å…·ä¸­æ·»åŠ ç§å­æ•°æ®é‡Œå­˜åœ¨çš„ç”¨æˆ· IDï¼Œä¾‹å¦‚ `student-1`ã€‚ |
| Jest æµ‹è¯•å¡åœ¨ VM Modules æç¤º | Node ç‰ˆæœ¬è¿‡ä½ (< 18) | å‡çº§è‡³ Node 18+ï¼Œæ¨èä½¿ç”¨ Node 20 LTSã€‚ |

æ›´å¤šèƒŒæ™¯ä¸åŠŸèƒ½å¯¹ç…§è¯·å‚è€ƒã€ŠåŠŸèƒ½æ¢³ç†ä¸å®ç°çŠ¶æ€æ€»è§ˆã€‹ã€‚å¦‚ä»æœ‰ç–‘é—®ï¼Œå¯åœ¨ Issue ä¸­é™„ä¸Šå‘½ä»¤è¡Œè¾“å‡ºä¸ `.env` è„±æ•é…ç½®ï¼Œä¾¿äºå¤ç°ä¸å®šä½ã€‚
