# 前端功能测试清单

> 用于验证前端所有功能是否正常工作

---

## 🧪 章节地图和关卡功能测试

### 测试前提条件
1. ✅ 后端服务已启动 (`http://localhost:8081`)
2. ✅ 前端服务已启动 (`http://localhost:3000`)
3. ✅ 用户已登录（学生账号）

### 测试步骤

#### 1. 测试章节地图加载

**路径**: `/student/levels`

**预期行为**:
- 应该显示2个章节卡片
  - 章节1：顺序启航 (3个关卡)
  - 章节2：循环岛屿 (2个关卡)
- 每个章节应显示进度条
- 应该显示筛选器（章节筛选、状态筛选）

**检查点**:
- [ ] 页面加载无错误
- [ ] 章节卡片正确显示
- [ ] 关卡列表正确显示（共5个关卡）
- [ ] 筛选功能正常工作

**调试提示**:
如果页面没有数据，打开浏览器开发工具：
1. 检查 Console 是否有错误
2. 检查 Network 标签页，查看 `/api/student/map` 请求是否成功
3. 查看请求返回的数据结构

#### 2. 测试关卡详情页

**操作**: 从章节地图点击任意关卡

**路径**: `/student/levels/:levelId` (例如 `/student/levels/level-1-1`)

**预期行为**:
- 显示关卡名称和状态徽章
- 显示三个标签页：任务目标、可用积木、教学漫画
- 显示"进入挑战"按钮
- 对于未解锁的关卡，按钮应显示为禁用状态

**检查点**:
- [ ] 页面路由跳转成功
- [ ] 关卡信息正确加载
- [ ] 标签页可以正常切换
- [ ] 按钮状态正确

**调试提示**:
如果关卡详情页报错：
1. 检查 `/api/student/levels/:id` 请求是否成功
2. 检查 `/api/student/levels/:id/prep` 请求是否成功
3. 查看返回数据是否包含完整的关卡信息

#### 3. 测试关卡挑战页

**操作**: 从关卡详情页点击"进入挑战"

**路径**: `/student/play/:levelId`

**预期行为**:
- 显示游戏场景（GameCanvas）
- 显示积木编程区（BlockEditor）
- 显示可用积木面板
- 可以拖拽积木进行编程

**检查点**:
- [ ] GameCanvas 正确渲染
- [ ] BlockEditor 正确显示
- [ ] 积木可以拖拽
- [ ] 程序可以运行

---

## 🔍 常见问题排查

### 问题1: 点击章节地图没有反应

**可能原因**:
1. 后端API未启动
2. API返回数据为空
3. 前端路由配置问题
4. React状态管理问题

**排查步骤**:
```javascript
// 1. 在浏览器Console中手动测试API
fetch('http://localhost:8081/api/student/map', {
  headers: { 'x-user-id': 'student-demo' }
})
.then(r => r.json())
.then(data => console.log(data));

// 预期返回:
{
  "chapters": [
    {
      "id": "chapter-1",
      "title": "顺序启航",
      "summary": "学习基础移动与转向指令",
      "order": 1,
      "levels": [...]
    },
    ...
  ]
}
```

**解决方案**:
- 确保后端服务已启动
- 检查 `useAppStore` 中的 `loadChapters` 函数是否被调用
- 检查 `chapters` 数组是否有数据

### 问题2: 点击关卡进入详情页报错

**可能原因**:
1. 关卡ID不匹配
2. API返回401/403/404错误
3. 关卡未解锁但前端尝试访问

**排查步骤**:
```javascript
// 手动测试关卡详情API
fetch('http://localhost:8081/api/student/levels/level-1-1', {
  headers: { 'x-user-id': 'student-demo' }
})
.then(r => r.json())
.then(data => console.log(data));
```

**解决方案**:
- 确保levelId参数正确传递
- 检查后端是否返回正确的关卡数据
- 确认用户已登录且有正确的x-user-id

### 问题3: 关卡地图显示空状态

**可能原因**:
1. `loadChapters()` 未被调用
2. API请求失败
3. 数据解析错误

**排查步骤**:
1. 打开React DevTools
2. 检查 `useAppStore` 的状态
3. 确认 `chapters` 数组的内容
4. 检查 `loading` 和 `error` 状态

---

## 📝 已知问题和限制

### 当前已实现的功能
- ✅ 章节地图展示
- ✅ 关卡列表筛选
- ✅ 关卡详情查看
- ✅ 关卡状态显示（已完成/可挑战/未解锁）
- ✅ 关卡挑战页面路由

### 需要后端支持的功能
- ⚠️ 关卡解锁逻辑（需要后端验证）
- ⚠️ 学习进度持久化（需要数据库支持）
- ⚠️ 成就系统（需要后端计算）

### 前端待完善功能
- ⏳ GameCanvas动画优化
- ⏳ BlockEditor拖拽体验优化
- ⏳ 移动端适配

---

## 🛠️ 调试技巧

### 添加调试日志

在 `LevelsPage.tsx` 中添加调试代码：

```typescript
useEffect(() => {
  console.log('[LevelsPage] Chapters loaded:', chapters);
  console.log('[LevelsPage] Loading state:', loading);
  console.log('[LevelsPage] Error state:', error);
}, [chapters, loading, error]);
```

在 `useAppStore.ts` 的 `loadChapters` 函数中添加：

```typescript
loadChapters: async () => {
  const { user } = get();
  if (!user || user.role !== 'student') {
    console.log('[Store] Cannot load chapters: no user or not student');
    return;
  }

  try {
    console.log('[Store] Loading chapters...');
    const response = await apiClient.getStudentMap();
    console.log('[Store] Chapters response:', response);
    
    if (response.error) {
      console.error('[Store] Error loading chapters:', response.error);
      set({ error: response.error });
      return;
    }
    
    if (response.data) {
      console.log('[Store] Chapters loaded successfully:', response.data.chapters);
      set({ chapters: response.data.chapters });
    }
  } catch (error) {
    console.error('[Store] Exception loading chapters:', error);
    set({ error: '加载章节数据失败' });
  }
}
```

### 使用React DevTools

1. 安装React DevTools浏览器扩展
2. 打开开发者工具的 "Components" 标签页
3. 选择 `LevelsPage` 组件
4. 查看组件的 props 和 hooks 状态
5. 检查 `chapters` 数组的内容

### 检查Network请求

1. 打开浏览器开发者工具的 "Network" 标签页
2. 刷新页面或触发相关操作
3. 查找 `/api/student/map` 请求
4. 检查：
   - 请求状态码 (应该是 200)
   - 请求头 (应包含 x-user-id)
   - 响应数据 (应包含 chapters 数组)

---

## ✅ 快速验证脚本

在浏览器Console中运行以下代码来快速验证：

```javascript
// 1. 检查后端是否运行
fetch('http://localhost:8081/api/health')
  .then(r => r.text())
  .then(console.log)
  .catch(e => console.error('Backend not running:', e));

// 2. 检查章节数据
fetch('http://localhost:8081/api/student/map', {
  headers: { 'x-user-id': 'student-demo' }
})
  .then(r => r.json())
  .then(data => {
    console.log('Chapters:', data.chapters?.length);
    console.log('Total levels:', data.chapters?.reduce((sum, ch) => sum + ch.levels.length, 0));
    data.chapters?.forEach(ch => {
      console.log(`  ${ch.title}: ${ch.levels.length} levels`);
    });
  });

// 3. 检查学生资料
fetch('http://localhost:8081/api/student/profile', {
  headers: { 'x-user-id': 'student-demo' }
})
  .then(r => r.json())
  .then(data => console.log('Student profile:', data));
```

预期输出:
```
Chapters: 2
Total levels: 5
  顺序启航: 3 levels
  循环岛屿: 2 levels
Student profile: { id: "student-demo", name: "小冒险家", ... }
```

---

*最后更新: 2025-09-30*
