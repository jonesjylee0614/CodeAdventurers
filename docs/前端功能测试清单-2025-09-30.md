# å‰ç«¯åŠŸèƒ½æµ‹è¯•æ¸…å•

> ç”¨äºéªŒè¯å‰ç«¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ

---

## ğŸ§ª ç« èŠ‚åœ°å›¾å’Œå…³å¡åŠŸèƒ½æµ‹è¯•

### æµ‹è¯•å‰ææ¡ä»¶
1. âœ… åç«¯æœåŠ¡å·²å¯åŠ¨ (`http://localhost:8081`)
2. âœ… å‰ç«¯æœåŠ¡å·²å¯åŠ¨ (`http://localhost:3000`)
3. âœ… ç”¨æˆ·å·²ç™»å½•ï¼ˆå­¦ç”Ÿè´¦å·ï¼‰

### æµ‹è¯•æ­¥éª¤

#### 1. æµ‹è¯•ç« èŠ‚åœ°å›¾åŠ è½½

**è·¯å¾„**: `/student/levels`

**é¢„æœŸè¡Œä¸º**:
- åº”è¯¥æ˜¾ç¤º2ä¸ªç« èŠ‚å¡ç‰‡
  - ç« èŠ‚1ï¼šé¡ºåºå¯èˆª (3ä¸ªå…³å¡)
  - ç« èŠ‚2ï¼šå¾ªç¯å²›å±¿ (2ä¸ªå…³å¡)
- æ¯ä¸ªç« èŠ‚åº”æ˜¾ç¤ºè¿›åº¦æ¡
- åº”è¯¥æ˜¾ç¤ºç­›é€‰å™¨ï¼ˆç« èŠ‚ç­›é€‰ã€çŠ¶æ€ç­›é€‰ï¼‰

**æ£€æŸ¥ç‚¹**:
- [ ] é¡µé¢åŠ è½½æ— é”™è¯¯
- [ ] ç« èŠ‚å¡ç‰‡æ­£ç¡®æ˜¾ç¤º
- [ ] å…³å¡åˆ—è¡¨æ­£ç¡®æ˜¾ç¤ºï¼ˆå…±5ä¸ªå…³å¡ï¼‰
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**è°ƒè¯•æç¤º**:
å¦‚æœé¡µé¢æ²¡æœ‰æ•°æ®ï¼Œæ‰“å¼€æµè§ˆå™¨å¼€å‘å·¥å…·ï¼š
1. æ£€æŸ¥ Console æ˜¯å¦æœ‰é”™è¯¯
2. æ£€æŸ¥ Network æ ‡ç­¾é¡µï¼ŒæŸ¥çœ‹ `/api/student/map` è¯·æ±‚æ˜¯å¦æˆåŠŸ
3. æŸ¥çœ‹è¯·æ±‚è¿”å›çš„æ•°æ®ç»“æ„

#### 2. æµ‹è¯•å…³å¡è¯¦æƒ…é¡µ

**æ“ä½œ**: ä»ç« èŠ‚åœ°å›¾ç‚¹å‡»ä»»æ„å…³å¡

**è·¯å¾„**: `/student/levels/:levelId` (ä¾‹å¦‚ `/student/levels/level-1-1`)

**é¢„æœŸè¡Œä¸º**:
- æ˜¾ç¤ºå…³å¡åç§°å’ŒçŠ¶æ€å¾½ç« 
- æ˜¾ç¤ºä¸‰ä¸ªæ ‡ç­¾é¡µï¼šä»»åŠ¡ç›®æ ‡ã€å¯ç”¨ç§¯æœ¨ã€æ•™å­¦æ¼«ç”»
- æ˜¾ç¤º"è¿›å…¥æŒ‘æˆ˜"æŒ‰é’®
- å¯¹äºæœªè§£é”çš„å…³å¡ï¼ŒæŒ‰é’®åº”æ˜¾ç¤ºä¸ºç¦ç”¨çŠ¶æ€

**æ£€æŸ¥ç‚¹**:
- [ ] é¡µé¢è·¯ç”±è·³è½¬æˆåŠŸ
- [ ] å…³å¡ä¿¡æ¯æ­£ç¡®åŠ è½½
- [ ] æ ‡ç­¾é¡µå¯ä»¥æ­£å¸¸åˆ‡æ¢
- [ ] æŒ‰é’®çŠ¶æ€æ­£ç¡®

**è°ƒè¯•æç¤º**:
å¦‚æœå…³å¡è¯¦æƒ…é¡µæŠ¥é”™ï¼š
1. æ£€æŸ¥ `/api/student/levels/:id` è¯·æ±‚æ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥ `/api/student/levels/:id/prep` è¯·æ±‚æ˜¯å¦æˆåŠŸ
3. æŸ¥çœ‹è¿”å›æ•°æ®æ˜¯å¦åŒ…å«å®Œæ•´çš„å…³å¡ä¿¡æ¯

#### 3. æµ‹è¯•å…³å¡æŒ‘æˆ˜é¡µ

**æ“ä½œ**: ä»å…³å¡è¯¦æƒ…é¡µç‚¹å‡»"è¿›å…¥æŒ‘æˆ˜"

**è·¯å¾„**: `/student/play/:levelId`

**é¢„æœŸè¡Œä¸º**:
- æ˜¾ç¤ºæ¸¸æˆåœºæ™¯ï¼ˆGameCanvasï¼‰
- æ˜¾ç¤ºç§¯æœ¨ç¼–ç¨‹åŒºï¼ˆBlockEditorï¼‰
- æ˜¾ç¤ºå¯ç”¨ç§¯æœ¨é¢æ¿
- å¯ä»¥æ‹–æ‹½ç§¯æœ¨è¿›è¡Œç¼–ç¨‹

**æ£€æŸ¥ç‚¹**:
- [ ] GameCanvas æ­£ç¡®æ¸²æŸ“
- [ ] BlockEditor æ­£ç¡®æ˜¾ç¤º
- [ ] ç§¯æœ¨å¯ä»¥æ‹–æ‹½
- [ ] ç¨‹åºå¯ä»¥è¿è¡Œ

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: ç‚¹å‡»ç« èŠ‚åœ°å›¾æ²¡æœ‰ååº”

**å¯èƒ½åŸå› **:
1. åç«¯APIæœªå¯åŠ¨
2. APIè¿”å›æ•°æ®ä¸ºç©º
3. å‰ç«¯è·¯ç”±é…ç½®é—®é¢˜
4. ReactçŠ¶æ€ç®¡ç†é—®é¢˜

**æ’æŸ¥æ­¥éª¤**:
```javascript
// 1. åœ¨æµè§ˆå™¨Consoleä¸­æ‰‹åŠ¨æµ‹è¯•API
fetch('http://localhost:8081/api/student/map', {
  headers: { 'x-user-id': 'student-demo' }
})
.then(r => r.json())
.then(data => console.log(data));

// é¢„æœŸè¿”å›:
{
  "chapters": [
    {
      "id": "chapter-1",
      "title": "é¡ºåºå¯èˆª",
      "summary": "å­¦ä¹ åŸºç¡€ç§»åŠ¨ä¸è½¬å‘æŒ‡ä»¤",
      "order": 1,
      "levels": [...]
    },
    ...
  ]
}
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨
- æ£€æŸ¥ `useAppStore` ä¸­çš„ `loadChapters` å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨
- æ£€æŸ¥ `chapters` æ•°ç»„æ˜¯å¦æœ‰æ•°æ®

### é—®é¢˜2: ç‚¹å‡»å…³å¡è¿›å…¥è¯¦æƒ…é¡µæŠ¥é”™

**å¯èƒ½åŸå› **:
1. å…³å¡IDä¸åŒ¹é…
2. APIè¿”å›401/403/404é”™è¯¯
3. å…³å¡æœªè§£é”ä½†å‰ç«¯å°è¯•è®¿é—®

**æ’æŸ¥æ­¥éª¤**:
```javascript
// æ‰‹åŠ¨æµ‹è¯•å…³å¡è¯¦æƒ…API
fetch('http://localhost:8081/api/student/levels/level-1-1', {
  headers: { 'x-user-id': 'student-demo' }
})
.then(r => r.json())
.then(data => console.log(data));
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿levelIdå‚æ•°æ­£ç¡®ä¼ é€’
- æ£€æŸ¥åç«¯æ˜¯å¦è¿”å›æ­£ç¡®çš„å…³å¡æ•°æ®
- ç¡®è®¤ç”¨æˆ·å·²ç™»å½•ä¸”æœ‰æ­£ç¡®çš„x-user-id

### é—®é¢˜3: å…³å¡åœ°å›¾æ˜¾ç¤ºç©ºçŠ¶æ€

**å¯èƒ½åŸå› **:
1. `loadChapters()` æœªè¢«è°ƒç”¨
2. APIè¯·æ±‚å¤±è´¥
3. æ•°æ®è§£æé”™è¯¯

**æ’æŸ¥æ­¥éª¤**:
1. æ‰“å¼€React DevTools
2. æ£€æŸ¥ `useAppStore` çš„çŠ¶æ€
3. ç¡®è®¤ `chapters` æ•°ç»„çš„å†…å®¹
4. æ£€æŸ¥ `loading` å’Œ `error` çŠ¶æ€

---

## ğŸ“ å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### å½“å‰å·²å®ç°çš„åŠŸèƒ½
- âœ… ç« èŠ‚åœ°å›¾å±•ç¤º
- âœ… å…³å¡åˆ—è¡¨ç­›é€‰
- âœ… å…³å¡è¯¦æƒ…æŸ¥çœ‹
- âœ… å…³å¡çŠ¶æ€æ˜¾ç¤ºï¼ˆå·²å®Œæˆ/å¯æŒ‘æˆ˜/æœªè§£é”ï¼‰
- âœ… å…³å¡æŒ‘æˆ˜é¡µé¢è·¯ç”±

### éœ€è¦åç«¯æ”¯æŒçš„åŠŸèƒ½
- âš ï¸ å…³å¡è§£é”é€»è¾‘ï¼ˆéœ€è¦åç«¯éªŒè¯ï¼‰
- âš ï¸ å­¦ä¹ è¿›åº¦æŒä¹…åŒ–ï¼ˆéœ€è¦æ•°æ®åº“æ”¯æŒï¼‰
- âš ï¸ æˆå°±ç³»ç»Ÿï¼ˆéœ€è¦åç«¯è®¡ç®—ï¼‰

### å‰ç«¯å¾…å®Œå–„åŠŸèƒ½
- â³ GameCanvasåŠ¨ç”»ä¼˜åŒ–
- â³ BlockEditoræ‹–æ‹½ä½“éªŒä¼˜åŒ–
- â³ ç§»åŠ¨ç«¯é€‚é…

---

## ğŸ› ï¸ è°ƒè¯•æŠ€å·§

### æ·»åŠ è°ƒè¯•æ—¥å¿—

åœ¨ `LevelsPage.tsx` ä¸­æ·»åŠ è°ƒè¯•ä»£ç ï¼š

```typescript
useEffect(() => {
  console.log('[LevelsPage] Chapters loaded:', chapters);
  console.log('[LevelsPage] Loading state:', loading);
  console.log('[LevelsPage] Error state:', error);
}, [chapters, loading, error]);
```

åœ¨ `useAppStore.ts` çš„ `loadChapters` å‡½æ•°ä¸­æ·»åŠ ï¼š

```typescript
loadChapters: async () => {
  const { user } = get();
  if (!user || user.role !== 'student') {
    console.log('[Store] Cannot load chapters: no user or not student');
    return;
  }

  try {
    console.log('[Store] Loading chapters...');
    const response = await apiClient.getStudentMap();
    console.log('[Store] Chapters response:', response);
    
    if (response.error) {
      console.error('[Store] Error loading chapters:', response.error);
      set({ error: response.error });
      return;
    }
    
    if (response.data) {
      console.log('[Store] Chapters loaded successfully:', response.data.chapters);
      set({ chapters: response.data.chapters });
    }
  } catch (error) {
    console.error('[Store] Exception loading chapters:', error);
    set({ error: 'åŠ è½½ç« èŠ‚æ•°æ®å¤±è´¥' });
  }
}
```

### ä½¿ç”¨React DevTools

1. å®‰è£…React DevToolsæµè§ˆå™¨æ‰©å±•
2. æ‰“å¼€å¼€å‘è€…å·¥å…·çš„ "Components" æ ‡ç­¾é¡µ
3. é€‰æ‹© `LevelsPage` ç»„ä»¶
4. æŸ¥çœ‹ç»„ä»¶çš„ props å’Œ hooks çŠ¶æ€
5. æ£€æŸ¥ `chapters` æ•°ç»„çš„å†…å®¹

### æ£€æŸ¥Networkè¯·æ±‚

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„ "Network" æ ‡ç­¾é¡µ
2. åˆ·æ–°é¡µé¢æˆ–è§¦å‘ç›¸å…³æ“ä½œ
3. æŸ¥æ‰¾ `/api/student/map` è¯·æ±‚
4. æ£€æŸ¥ï¼š
   - è¯·æ±‚çŠ¶æ€ç  (åº”è¯¥æ˜¯ 200)
   - è¯·æ±‚å¤´ (åº”åŒ…å« x-user-id)
   - å“åº”æ•°æ® (åº”åŒ…å« chapters æ•°ç»„)

---

## âœ… å¿«é€ŸéªŒè¯è„šæœ¬

åœ¨æµè§ˆå™¨Consoleä¸­è¿è¡Œä»¥ä¸‹ä»£ç æ¥å¿«é€ŸéªŒè¯ï¼š

```javascript
// 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
fetch('http://localhost:8081/api/health')
  .then(r => r.text())
  .then(console.log)
  .catch(e => console.error('Backend not running:', e));

// 2. æ£€æŸ¥ç« èŠ‚æ•°æ®
fetch('http://localhost:8081/api/student/map', {
  headers: { 'x-user-id': 'student-demo' }
})
  .then(r => r.json())
  .then(data => {
    console.log('Chapters:', data.chapters?.length);
    console.log('Total levels:', data.chapters?.reduce((sum, ch) => sum + ch.levels.length, 0));
    data.chapters?.forEach(ch => {
      console.log(`  ${ch.title}: ${ch.levels.length} levels`);
    });
  });

// 3. æ£€æŸ¥å­¦ç”Ÿèµ„æ–™
fetch('http://localhost:8081/api/student/profile', {
  headers: { 'x-user-id': 'student-demo' }
})
  .then(r => r.json())
  .then(data => console.log('Student profile:', data));
```

é¢„æœŸè¾“å‡º:
```
Chapters: 2
Total levels: 5
  é¡ºåºå¯èˆª: 3 levels
  å¾ªç¯å²›å±¿: 2 levels
Student profile: { id: "student-demo", name: "å°å†’é™©å®¶", ... }
```

---

*æœ€åæ›´æ–°: 2025-09-30*
