# 学生端功能清单

> 本文按照「登录 → 学习 → 复盘 → 个性化」的流程梳理学生端已经实现的功能模块及关键依赖，便于测试、产品与开发协同核对。所有 API 均位于 `services/api/src/index.ts`，前端页面源于 `apps/web/src/app/pages/student` 目录。

## 1. 账号与进入

| 功能 | 实现位置 | 说明 |
| --- | --- | --- |
| 游客体验登录 | `AuthModal` 触发 `apiClient.loginAsGuest` → `POST /api/auth/guest` | 随机生成体验账号，落至体验班级，支持匿名试玩。 |
| 班级邀请码加入 | `AuthModal` 触发 `apiClient.joinClass` → `POST /api/auth/class` | 新学生填写姓名与邀请码后自动落班，`useAppStore` 持久化状态。 |
| 登录态持久化 | `useAppStore`（`zustand` + `persist`） | 将 `user` 与 `chapters` 缓存至 `localStorage`，刷新页面后保持身份。 |

## 2. 学习地图与关卡

| 功能 | 实现位置 | 说明 |
| --- | --- | --- |
| 章节地图展示 | `StudentLevelsPage` → `apiClient.getStudentMap` → `GET /api/student/map` | 依据课程章节渲染章节卡片、关卡状态（已完成/可解锁/待解锁）。 |
| 关卡准备面板 | `LevelDetailPage` → `apiClient.getLevelPrep` → `GET /api/student/levels/:id/prep` | 展示胜利条件、可用积木、奖励等前置信息。 |
| BlockEditor 拖拽编排 | `BlockEditor.tsx` | 支持拖拽指令、嵌套控制结构、参数配置，实时语法校验。 |
| 模拟运行/重置 | `PlayPage` → `apiClient.runLevel` / `resetGame` | 将编排的程序提交后播放动画，支持重置、提示次数控制。 |
| 关卡结算与奖励 | `PlayPage` → `apiClient.completeLevel` → `POST /api/student/levels/:id/complete` | 记录星级、步数、时长，解锁装扮与沙盒，触发 `telemetry`。 |
| Hint 提示 | `PlayPage` → `apiClient.getHint` → `POST /api/student/hints/:id` | 根据尝试次数与最后错误返回动态提示。 |

## 3. 成就与成长记录

| 功能 | 实现位置 | 说明 |
| --- | --- | --- |
| 成就/图鉴展示 | `AchievementsPage` → `GET /api/student/profile` / `GET /api/student/compendium` | 展示勋章、图鉴条目以及奖励的装扮。 |
| 装扮管理 | `SettingsPage` → `apiClient.getStudentAvatar`/`updateStudentAvatar` | 查看与切换当前装扮，校验是否已解锁。 |
| 学习周报 | `GET /api/parent/children/:childId/weekly-report` | 与家长端共享周报数据，内容由 `services/api/src/seed.ts` 预置。 |
| 沙盒作品库 | `PlayPage` 结算 → `student/sandbox` 系列接口 | 完成课程后解锁沙盒创作，支持发布到班级、教师审核。 |

## 4. 个性化与系统设置

| 功能 | 实现位置 | 说明 |
| --- | --- | --- |
| 音量/语言等设置 | `StudentSettingsPage` → `apiClient.getStudentSettings`/`updateStudentSettings` | 支持保存语言、低动态模式、音量等偏好。 |
| 进度清零 | `StudentSettingsPage` → `apiClient.resetStudentProgress` | 重置关卡进度与沙盒解锁状态，用于重新体验。 |
| 提示次数限制 | `services/api/src/index.ts` 教师端接口 | 教师可在班级设置提示次数，学生端在关卡中尊重限制。 |

## 5. 数据与可视化

| 功能 | 实现位置 | 说明 |
| --- | --- | --- |
| 实时 Telemetry | `services/api/src/index.ts` → `/api/telemetry` | 记录运行、提示等事件，用于教师端可视化分析。 |
| Jest 接口测试 | `tests/services/api.test.ts` | 覆盖学生关卡流转、提示、沙盒、头像等核心接口。 |

---

> 如需排查具体流程，可结合对应 API 响应（位于 `services/api/src/index.ts`）与页面组件查看，学生端所有状态均由 `useAppStore` 管理，并在 `apps/web/src/services/api/client.ts` 中统一封装请求方法。
