# 功能梳理与实现状态总览

> 2024/05 起，原 Node.js 实现已全面替换为 Go 版本（`backend`）。下表分为“已迁移”与“待迁移”两部分，便于追踪后端重构进度。

## 1. 已迁移接口（Go 服务）

| 编号 | 功能 | 设计关键点 | 代码对应 | 状态 |
| --- | --- | --- | --- | --- |
| S-01 | 启动/登录 | 游客模式、班级邀请码登录 | `backend/internal/http/handlers/auth/handler.go` | ✅ |
| S-02 | 首页/冒险地图 | 章节岛屿、关卡节点 | `backend/internal/http/handlers/student/handler.go` → `Map` | ✅ |
| S-03 | 关卡准备页 | 胜利条件/可用积木/教学漫画 | `backend/internal/http/handlers/student/handler.go` → `Prep` | ✅ |
| S-04 | 关卡主界面 | 场景/积木库/程序区/目标区 | `backend/internal/http/handlers/student/handler.go` → `Run` | ✅ |
| S-05 | 结算页 | 星级、奖励、最佳方案差距、CTA | `backend/internal/http/handlers/student/handler.go` → `Complete` | ✅ |
| S-08 | 沙盒创作 | 创建/测试/发布、积木库 | `backend/internal/http/handlers/student/handler.go` → `Sandbox` | ✅ |
| T-04 | 进度与看板 | 热力图、榜单、用时统计、回放 | `backend/internal/http/handlers/teacher/handler.go` | ✅ |
| B-01 | API 层 | Gin + OpenTelemetry 路由层 | `backend/cmd/api/main.go`、`backend/internal/http/router` | ✅ |
| B-03 | 数据库与缓存 | MySQL/Redis 连接封装 | `backend/internal/platform/storage`、`backend/internal/platform/cache` | ✅ |
| B-05 | 观测与探针 | `/healthz`、`/readyz`、`/metrics` | `backend/internal/service/health` + `backend/internal/http/handlers/health` | ✅ |

## 2. 待迁移与重构中的接口

| 模块 | 功能 | 迁移说明 |
| --- | --- | --- |
| 学生端 | 角色装扮、图鉴馆、作品库、设置 | 旧逻辑在 Node 版中实现，Go 版待根据领域模型重写。 |
| 教师端 | 课程管理、关卡编辑、班级布置、作品审核 | 需结合 sqlc 查询与 asynq 任务拆分，当前占位目录 `backend/internal/repo/`。 |
| 家长端 | 进度页、周报 | 原有 API 暂未迁移，待确定与学生端进度模型的映射。 |
| 管理员端 | 运营看板、素材与账号管理、数据导出 | 计划拆分为独立子服务，Go 版暂未实现。 |
| 遥测 | Tick/Hint 事件、回放日志 | 需要补充事件表结构与 asynq 工作流，目前仅保留接口约束。 |
| 自动化测试 | 集成测试、回放验证 | Node 版 Jest 测试待替换为 Go + dockertest。 |

## 3. 交互闭环验收项

Go 版本尚未补齐自动化回归测试，原有 Jest 场景保留为参考。后续将在 `backend/cmd/api` 层补充 httptest + dockertest，复用以下核心验收思路：

- AC-L1：新手 60 秒首通、错误提示匹配、通关解锁沙盒召回。
- AC-L2：遥测热力图、回放查询、卡关榜单。

| 编号 | AC 指标 | 代码对应 | 状态 |
| --- | --- | --- | --- |
| AC-L1-01 | 新手 ≤60s 完成首关 | Go 集成测试待补（计划：`httptest` + dockertest） | 🚧 |
| AC-L1-02 | 失败提示与错误匹配 | `/api/student/hints/:levelId`（待迁移） | 🚧 |
| AC-L1-03 | 通关推进与动机文案 | `backend/internal/http/handlers/student` → `Complete` | ✅ |
| AC-L1-04 | 通关解锁沙盒并召回 | `backend/internal/http/handlers/student` → `Sandbox` | ✅ |
| AC-L2-01 | 遥测与概念热力图 | `/api/teacher/analytics/*`（仅占位返回） | 🚧 |
| AC-L2-02 | 关卡回放 | `/api/teacher/analytics/replays/:studentId/:levelId`（待实现） | 🚧 |
| AC-L2-03 | 卡关榜单下发复训关 | `/api/teacher/analytics/progress`（待实现） | 🚧 |

## 4. 结论与建议

系统已完成 Go 单体服务的首轮迁移，实现核心学生运行链路与教师分析骨架。后续建议：

1. 补充正式前端界面与设计联调。
2. 将遥测与工作流事件落地到 MySQL 专用表或数据仓库。
3. 在 `docs/环境配置.md` 指引下完善容器化与 CI/CD。
4. 扩展自定义榜单与个性化推荐算法。
