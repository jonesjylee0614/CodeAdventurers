# 未完成功能清单（2025-版需求对照）

> 依据《设计方案.md》v1.0 的全端需求，对代码仓库现状进行逐项核查，标记尚未完成或仍为占位实现的功能，供下一步排期与交付评审参考。【F:docs/设计方案.md†L70-L152】

## 学生端（Web）

| 模块 | 设计期望 | 当前状态 | 影响与建议 |
| --- | --- | --- | --- |
| 关卡运行（Play） | 关卡数据来自后端 `/student/levels/:id/run`，并串联准备→游玩→结算流程。【F:docs/设计方案.md†L72-L81】 | 页面直接从 `/levels/sample-1.json` 读取本地示例，未调用真实 API；缺少对 `setProgram` 的接入，导致页面无法加载或与后端数据脱节。【F:apps/web/src/app/pages/student/PlayPage.tsx†L54-L112】 | 需要替换为调用 `apiClient.getStudentMap`/`getLevelPrep` 返回的真实关卡对象，并处理 404/锁定态，确保首关与后续关卡可联调。 |
| 冒险地图状态 | 地图需呈现“解锁→可挑战→已完成”的进度，并驱动下一关按钮。【F:docs/设计方案.md†L72-L78】 | API 仅返回 `completed`/`locked`；前端仍以 `unlocked` 状态过滤，导致所有未完成关卡被判定为“未解锁”。【F:services/api/src/index.ts†L384-L423】【F:apps/web/src/app/pages/student/LevelsPage.tsx†L12-L114】 | 后端需计算下一关的可挑战状态（或前端本地推导）；前端过滤条件与状态枚举需同步修正。 |
| 关卡准备与详情 | 需展示胜利条件、可用积木、教学漫画等真实内容。【F:docs/设计方案.md†L74-L81】 | LevelDetailPage 完全写死静态文案，没有消费 `getLevelPrep` 返回的数据，也缺少教学漫画展示容器。【F:apps/web/src/app/pages/student/LevelDetailPage.tsx†L9-L24】 | 将准备页改为调用接口并渲染 `victoryCondition`、`allowedBlocks`、`comic` 字段；补充骨架状态与错误处理。 |
| Block Editor 积木能力 | 需要支持循环次数、条件等参数编辑，对应 Hint 策略。【F:docs/设计方案.md†L104-L123】 | `repeat` 固定次数为 3，条件积木同样硬编码，缺少 UI 让学生调整指令或填充嵌套块。【F:apps/student/src/BlockEditor.tsx†L52-L139】 | 设计参数编辑面板，或引入可配置弹窗，至少允许循环次数/条件下拉选择。 |
| 结算页 | 需展示星级、奖励、最佳差距和下一步 CTA。【F:docs/设计方案.md†L75-L78】 | ResultPage 为纯静态占位，未与 `completeLevel` 结果或奖励挂钩，也未在 PlayPage 内触发实际弹窗逻辑。【F:apps/web/src/app/pages/student/ResultPage.tsx†L1-L22】【F:apps/web/src/app/pages/student/PlayPage.tsx†L100-L117】 | 将结算逻辑整合进 PlayPage（或单独路由）并渲染 `simulationResult` 返回值；调用 `/student/levels/:id/complete` 后根据响应展示奖励。 |
| 设置/语音 | 需可保存音量、语言、低动效等设置并回写后端。【F:docs/设计方案.md†L79-L81】 | SettingsPage 仅在控制台输出，缺少与 `apiClient.updateStudentSettings` 的交互以及成功/失败反馈。【F:apps/web/src/app/pages/student/SettingsPage.tsx†L30-L36】 | 使用 `useAppStore`/React Query 提交设置，增加保存中/保存成功提示与错误处理。 |
| 成就与装扮 | 应基于真实进度数据计算、展示来源说明。【F:docs/设计方案.md†L77-L78】【F:docs/设计方案.md†L145-L150】 | AchievementsPage 用 `Math.random()` 伪造连续天数，装扮/成就条件写死且未与 `/student/avatar`、`/compendium` 等接口同步；缺少获取/换装动作。【F:apps/web/src/app/pages/student/AchievementsPage.tsx†L68-L168】 | 改为读取 `studentProfile` 与奖励配置；实现装扮切换/图鉴解锁 API；展示真实来源文案。 |

## 教师端

| 模块 | 设计期望 | 当前状态 | 影响与建议 |
| --- | --- | --- | --- |
| 认证入口 | 教师账号需通过邮箱/密码或单点方式登录后访问后台。【F:docs/设计方案.md†L83-L89】 | AuthPage 中教师/家长 Tab 被禁用，按钮标记“暂未开放”。【F:apps/web/src/app/pages/shared/AuthPage.tsx†L170-L236】 | 需实现教师/家长登录流程（API 或临时模拟），并在路由守卫中根据角色分流。 |
| 概览看板 | 展示真实班级、学生、关卡、掌握度数据。【F:docs/设计方案.md†L85-L89】 | OverviewPage 虽调用 API，但界面渲染完全来自 `mockStats`/`mockConcepts`/`mockAlerts`，未消费接口响应值；无错误提示。【F:apps/web/src/app/pages/teacher/OverviewPage.tsx†L35-L189】 | 替换 mock 为接口返回的真实结构，若暂无数据需优雅降级；补充加载/错误状态。 |
| 作业布置、内容管理 | 需对接课程、章节、关卡 CRUD。【F:docs/设计方案.md†L85-L87】 | AssignmentsPage/ContentPage 仅渲染硬编码数组和占位 Drawer，无检索、批量操作或 API 调用。【F:apps/web/src/app/pages/teacher/AssignmentsPage.tsx†L8-L42】【F:apps/web/src/app/pages/teacher/ContentPage.tsx†L8-L37】 | 建立与 `/api/teacher/courses*`、`/chapters`、`/levels` 的数据流，提供增删改查与抽屉详情。 |
| 进度分析 | 应包含热力图、卡关榜、回放入口。【F:docs/设计方案.md†L88-L89】 | AnalyticsPage 全为 EmptyState，占位文案提示“等待数据接入”，未显示任何图表或链接。【F:apps/web/src/app/pages/teacher/AnalyticsPage.tsx†L1-L13】 | 接入 `/teacher/analytics/*` 接口，渲染统计卡片和图表，可嵌入回放跳转。 |

## 家长端

| 模块 | 设计期望 | 当前状态 | 影响与建议 |
| --- | --- | --- | --- |
| 首页与进度页 | 应展示孩子真实进度、常见错误、周报下载。【F:docs/设计方案.md†L91-L94】 | HomePage/ProgressPage 使用固定文本与占位组件，未连接 `/parent/children`、`/progress`、`/weekly-report`；错题集等信息缺失。【F:apps/web/src/app/pages/parent/HomePage.tsx†L5-L17】【F:apps/web/src/app/pages/parent/ProgressPage.tsx†L9-L20】 | 调用相关 API，加入子女选择器、下载按钮与错题列表；提供无数据的空状态。 |
| 家长设置 | 需保存提醒时间、家校沟通偏好等配置。【F:docs/设计方案.md†L91-L94】 | SettingsPage 仅 `console.log`，没有提交接口或结果提示。【F:apps/web/src/app/pages/parent/SettingsPage.tsx†L11-L36】 | 建议引入表单验证、提交状态与成功 Toast，同时对接后端存储。 |

## 管理端

| 模块 | 设计期望 | 当前状态 | 影响与建议 |
| --- | --- | --- | --- |
| 运营/指标 | 需呈现真实活跃度、素材、账号、导出数据。【F:docs/设计方案.md†L83-L89】 | Overview/Users/Curriculum/Ops 页面均填充硬编码数组或 EmptyState，占位按钮无后续逻辑。【F:apps/web/src/app/pages/admin/OverviewPage.tsx†L1-L14】【F:apps/web/src/app/pages/admin/UsersPage.tsx†L8-L40】【F:apps/web/src/app/pages/admin/CurriculumPage.tsx†L5-L10】【F:apps/web/src/app/pages/admin/OpsPage.tsx†L6-L23】 | 与 `/api/admin/*`、`/api/teacher/works` 等接口对接，补齐增删改查和导出下载；在无权限或无数据时给出反馈。 |

## 跨端与基础能力

| 项 | 设计期望 | 当前状态 | 建议 |
| --- | --- | --- | --- |
| Hint & 动画策略 | 根据失败次数提供不同级别提示，并配合动效反馈。【F:docs/设计方案.md†L112-L123】 | PlayPage 未实现提示分层或动效；只是在 `getHint` 后简单弹出模态，且没有语音/动画实现。【F:apps/web/src/app/pages/student/PlayPage.tsx†L95-L187】 | 结合 `computeHint` 结果区分提示类型，加入高亮与语音占位；引入 Lottie/Pixi 等动效方案。 |
| 响应式与样式体系 | 需要统一风格、支持低动效模式。【F:docs/设计方案.md†L96-L100】 | 大量页面使用内联样式与固定宽度（如 PlayPage 右侧 400px 面板），Button 缺少 `:focus` 状态，低动效模式未实现。【F:apps/web/src/app/pages/student/PlayPage.tsx†L180-L189】【F:apps/web/src/components/ui/button.css†L1-L33】 | 引入设计系统（CSS 变量/Theme Provider），补充焦点样式与媒体查询；在设置页调节低动效模式。 |

---

以上功能需在进入下一里程碑前列入迭代计划，优先解决“真实数据接入”与“核心流程可用性”问题，再逐步补齐动效、个性化与后台管理能力。
